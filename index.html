<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mini Souls-like 3D (Pixel Art) - Start Edition</title>
  <script src="https://unpkg.com/three@0.154.0/build/three.min.js"></script>
  <style>
    html,body{height:100%;margin:0;background:#0f0f12;color:#eee;font-family:Inter,system-ui,monospace}
    canvas{display:block}
    #overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#0f0f12;z-index:999}
    #startBtn{padding:18px 36px;font-size:20px;border:0;border-radius:12px;cursor:pointer;background:#6ab04c;color:#0f0f12;font-weight:700}
    #ui{position:fixed;left:12px;top:12px;z-index:10;max-width:360px}
    .panel{background:rgba(0,0,0,0.45);padding:10px;border-radius:8px;margin-bottom:8px}
    .bar,.bar2{height:8px;background:#333;border-radius:8px;overflow:hidden}
    .bar .fill{background:linear-gradient(90deg,#e74c3c,#e67e22);height:100%}
    .bar2 .fill{background:linear-gradient(90deg,#00b894,#00cec9);height:100%}
  </style>
</head>
<body>

<div id="overlay">
  <button id="startBtn">START GAME</button>
</div>

<div id="ui" style="display:none">
  <div class="panel">
    <strong>Mini Souls-like</strong>
    <div>WASD mover • Mouse girar • Clique atacar • Espaço esquiva</div>
  </div>
  <div class="panel">
    Vida <span id="hpText">100</span>
    <div class="bar" style="width:260px"><div id="hpFill" class="fill" style="width:100%"></div></div>
    <br>Stamina <span id="stText">100</span>
    <div class="bar2" style="width:260px"><div id="stFill" class="fill" style="width:100%"></div></div>
  </div>
</div>

<script>
let scene,camera,renderer;
let clock=new THREE.Clock();
let audioCtx=null, started=false;
let player,enemies=[],projectiles=[];
let input={forward:false,back:false,left:false,right:false,attacking:false,dodge:false};
let invulnerable=0,attackCooldown=0,dodgeCooldown=0;

const startBtn=document.getElementById('startBtn');
const overlay=document.getElementById('overlay');

startBtn.onclick=()=>{
  initAudio();
  overlay.style.display='none';
  document.getElementById('ui').style.display='block';
  start();
};

function initAudio(){ if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)(); }

function start(){ if(started) return; started=true; init(); animate(); }

function init(){
  scene=new THREE.Scene(); scene.background=new THREE.Color(0x0c0c0e);
  camera=new THREE.PerspectiveCamera(65,innerWidth/innerHeight,0.1,1000);
  camera.position.set(0,5,9);
  renderer=new THREE.WebGLRenderer({antialias:true}); renderer.setSize(innerWidth,innerHeight);
  document.body.appendChild(renderer.domElement);

  scene.add(new THREE.AmbientLight(0xffffff,0.5));
  const d=new THREE.DirectionalLight(0xffffff,0.6); d.position.set(4,10,2); scene.add(d);

  const ground=new THREE.Mesh(new THREE.PlaneGeometry(60,60),new THREE.MeshStandardMaterial({color:0x202024}));
  ground.rotation.x=-Math.PI/2; scene.add(ground);

  player=createActor('#6ab04c',100);
  player.mesh.position.set(0,0.5,0);
  player.stamina=100; player.maxStamina=100;
  scene.add(player.mesh);

  for(let i=0;i<5;i++) spawnEnemy();

  window.addEventListener('keydown',kDown);
  window.addEventListener('keyup',kUp);
  renderer.domElement.addEventListener('pointerdown',()=>{input.attacking=true;});
  renderer.domElement.addEventListener('pointerup',()=>{input.attacking=false;});
  window.addEventListener('resize',()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight);});
}

function createActor(color,hp){
  const g=new THREE.BoxGeometry(0.9,0.9,0.9);
  const m=new THREE.MeshStandardMaterial({map:pixelTexture(color)});
  const mesh=new THREE.Mesh(g,m);
  return {mesh,hp,maxHp:hp};
}

function spawnEnemy(){
  const e=createActor('#e74c3c',40);
  const a=Math.random()*Math.PI*2,r=8+Math.random()*6;
  e.mesh.position.set(Math.cos(a)*r,0.5,Math.sin(a)*r);
  e.cooldown=1;
  enemies.push(e); scene.add(e.mesh);
}

function animate(){
  if(!started) return;
  requestAnimationFrame(animate);
  const dt=Math.min(0.05,clock.getDelta());
  updatePlayer(dt);
  updateEnemies(dt);
  camera.position.lerp(player.mesh.position.clone().add(new THREE.Vector3(0,5,9)),0.1);
  camera.lookAt(player.mesh.position);
  renderer.render(scene,camera);
}

function updatePlayer(dt){
  let dir=new THREE.Vector3();
  if(input.forward) dir.z-=1; if(input.back) dir.z+=1; if(input.left) dir.x-=1; if(input.right) dir.x+=1;
  if(dir.lengthSq()>0){dir.normalize(); player.mesh.position.add(dir.multiplyScalar(4*dt)); player.mesh.lookAt(player.mesh.position.clone().add(dir));}

  attackCooldown-=dt; dodgeCooldown-=dt; invulnerable=Math.max(0,invulnerable-dt);

  if(input.attacking && attackCooldown<=0){attackCooldown=0.6; play('attack'); enemies.forEach(e=>{if(e.mesh.position.distanceTo(player.mesh.position)<2){e.hp-=20;}});}

  document.getElementById('hpText').innerText=Math.max(0,Math.round(player.hp));
}

function updateEnemies(dt){
  enemies.forEach((e,i)=>{
    if(e.hp<=0){scene.remove(e.mesh); enemies.splice(i,1); return;}
    const d=player.mesh.position.clone().sub(e.mesh.position); const dist=d.length();
    if(dist>1.5) e.mesh.position.add(d.normalize().multiplyScalar(1.2*dt));
    e.cooldown-=dt;
    if(dist<1.5 && e.cooldown<=0 && invulnerable<=0){player.hp-=8; e.cooldown=1.2; play('hit');}
    e.mesh.lookAt(player.mesh.position);
  });
}

function pixelTexture(color){
  const c=document.createElement('canvas'); c.width=c.height=16; const ctx=c.getContext('2d');
  ctx.fillStyle=color; ctx.fillRect(0,0,16,16);
  const t=new THREE.CanvasTexture(c); t.magFilter=THREE.NearestFilter; t.minFilter=THREE.NearestFilter; return t;
}

function play(type){ if(!audioCtx) return; const t=audioCtx.currentTime; const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.type='square'; o.frequency.value=(type==='attack'?440:140); g.gain.setValueAtTime(0.0001,t); g.gain.exponentialRampToValueAtTime(0.05,t+0.02); g.gain.exponentialRampToValueAtTime(0.0001,t+0.2); o.start(); o.stop(t+0.2);} 

function kDown(e){ if(e.code==='KeyW')input.forward=true; if(e.code==='KeyS')input.back=true; if(e.code==='KeyA')input.left=true; if(e.code==='KeyD')input.right=true; if(e.code==='Space')input.dodge=true; }
function kUp(e){ if(e.code==='KeyW')input.forward=false; if(e.code==='KeyS')input.back=false; if(e.code==='KeyA')input.left=false; if(e.code==='KeyD')input.right=false; if(e.code==='Space')input.dodge=false; }

</script>
</body>
</html>
